# Технический документ
## Проект: "Хроники Вечной Войны"

---

### 1. Введение

**"Хроники Вечной Войны"** — это 2D-стратегия в средневековом сеттинге (8–12 века), где игрок выступает в роли бога-наблюдателя. Игрок не управляет армиями напрямую, а влияет на ход событий через погоду, катастрофы, советы, передачу информации и другие механики. Искусственный интеллект (ИИ) генералов учится, эволюционирует и оставляет наследие, что делает каждую партию уникальной.

---

### 2. Основные игровые механики

#### 2.1. Мир и карта
- 2D-тайловая карта с ландшафтами, каждый из которых имеет подтипы с уникальными характеристиками:
  - **Равнины:**
    - *Зелёное поле:* Высокая скорость, идеально для кавалерии, но нет защиты.
    - *Выжженная пустошь:* Средняя скорость, пыль снижает видимость.
    - *Цветущий луг:* Средняя скорость, бонус к морали и восстановлению усталости.
    - *Каменистая степь:* Низкая скорость, лёгкий бонус к защите.
  - **Леса:**
    - *Хвойный бор:* Средняя скорость, хорошая защита от стрел, ограниченная видимость.
    - *Густой лиственный лес:* Низкая скорость, высокая защита, шанс потерять юнитов.
    - *Тёмная чаща:* Очень низкая скорость, идеально для засад, уязвима для огня.
    - *Редколесье:* Высокая скорость, слабая защита, подходит для манёвров.
  - **Горы:**
    - *Пологие холмы:* Средняя скорость, бонус к защите и обзору для стрелков.
    - *Крутые скалы:* Очень низкая скорость, почти полная защита, непроходимы для осадных машин.
    - *Узкое ущелье:* Высокая скорость вдоль пути, но уязвимо для атак сверху.
    - *Плато:* Средняя скорость, отличный обзор, но открыто для ветров и бурь.
  - **Водоёмы:**
    - *Мелкая река:* Низкая скорость переправы, юниты уязвимы во время перехода.
    - *Глубокое озеро:* Непроходимо, создаёт естественный барьер.
    - *Топкое болото:* Очень низкая скорость, шанс застревания, снижает мораль.
    - *Песчаный брод:* Средняя скорость переправы, но уязвим для наводнений.
  - **Городские территории:**
    - *Деревня:* Бонус к защите, возможность грабежа или рекрутирования.
    - *Укреплённый город:* Высокая защита, центр снабжения, но уязвим для осады.
    - *Замок:* Максимальная защита, командный пункт, но требует ресурсов.
    - *Разрушенные руины:* Средняя защита, бонус к засадам, но нет снабжения.
  - **Военные постройки:** лагеря (защита, восстановление), стоянки (быстрый отдых, уязвимы).
- Карта разделена на регионы, контролируемые фракциями.
- Ландшафт влияет на скорость, защиту, мораль, видимость, снабжение.

#### 2.2. Фракции и армии
- Несколько фракций с уникальными цветами, гербами, стартовыми условиями.
- Армии формируются фракциями, пополняются наймом, слиянием, разделением.
- Армии состоят из разных типов юнитов и специальных отрядов.

#### 2.3. Юниты и специальные отряды
- **Пехота:**
  - *Копейщики:* Сильны против кавалерии, слабы против стрелков.
  - *Мечники:* Универсальны, бонус в лесах за манёвренность.
  - *Щитоносцы:* Высокая защита, но медленны на равнинах и в болотах.
  - *Алебардщики:* Эффективны против брони, но уязвимы на открытой местности.
- **Кавалерия:**
  - *Лёгкая кавалерия:* Быстрая, идеальна для разведки и флангов на равнинах.
  - *Тяжёлая кавалерия:* Мощная атака, но теряет эффективность в лесах и горах.
  - *Конные лучники:* Стреляют на ходу, слабы в ближнем бою и на пересечённой местности.
  - *Рыцари-копейщики:* Сокрушительный первый удар, но медленное восстановление.
- **Стрелки:**
  - *Лучники:* Дальний бой, бонус на холмах, слабы в дождь и туман.
  - *Арбалетчики:* Пробивают броню, медленная перезарядка, хороши в обороне.
  - *Пращники:* Дешёвые, слабые, но быстрые и мобильные.
  - *Метатели дротиков:* Средняя дальность, бонус против лёгких юнитов.
- **Осадные машины:**
  - *Катапульта:* Разрушает стены и здания, но медленная и уязвима для атак.
  - *Таран:* Ломает ворота, но требует защиты от стрелков.
  - *Баллиста:* Точная атака на дистанции, пробивает броню юнитов.
  - *Огненный требушет:* Поджигает леса и здания, но сложен в управлении.
- **Обозы:** отвечают за снабжение армии (еда, боезапас, медикаменты).
- **Спец. отряды:** разведчики, инженеры, жрецы, шпионы, телохранители, убийцы, диверсанты, герои/легендарные личности.

#### 2.4. Генералы и ИИ
- Каждый генерал — уникальный ИИ-агент с характером, стартовой базой знаний и системой обучения.
- Генералы учатся во время и после боёв, корректируют тактики, анализируют события, формируют наследие.
- Генералы могут быть убиты, ранены, дезертировать, стать героями или предателями.

#### 2.5. Погода, времена года, катастрофы
- Динамическая погода: дождь, снег, туман, буря, жара, мороз.
- Цикл дня и ночи, смена сезонов.
- Катастрофы: чума, засуха, пожары, нашествия саранчи, землетрясения, наводнения.
- Погодные и сезонные эффекты влияют на боеспособность, снабжение, мораль, передвижение.

#### 2.6. Влияние игрока
- Изменение погоды и вызов катастроф.
- Советы генералам (через шаблоны или свободный текст).
- Передача любой информации генералам (NLP-модуль парсит и интерпретирует текст).
- Остановка времени, допрос генерала о мотивах и планах.
- Поддержка или подавление бунтов, вмешательство в катастрофы.

#### 2.7. Боевая система
- Открытые сражения, засады, осады, ночные налёты, диверсии, стычки.
- Тактики зависят от ландшафта, погоды, времени суток, морали, снабжения, советов игрока.
- Генералы учатся и меняют тактику по ходу боя.
- После боя — анализ, корректировка базы знаний, формирование отчётов.

#### 2.8. Снабжение и расходники
- Боезапас, медикаменты (травы, мази, вино и др.), еда и вода, броня и оружие.
- Расходуются в боях, походах, пополняются через обозы, снабжение, захват, торговлю.
- При низкой морали — дезертирство, потери, бунты.

#### 2.9. Герои, достижения и сценарии
- Уникальные личности с особыми способностями (вдохновлять, давать уникальные тактики, влиять на исход событий).
- Система достижений и сценариев для генералов (например, "непобедимый", "мастер засад", "спаситель обозов").
- Достижения влияют на наследие генералов и бонусы для преемников.

#### 2.10. Модульность и поддержка модов
- Лёгкое добавление новых юнитов, ландшафтов, сценариев, тактик, событий.
- Раздел "Моды" в главном меню для управления пользовательскими дополнениями.

---

### 3. Техническая архитектура

#### 3.1. Ядро ИИ-генерала
- Класс `GeneralAI`:
  - `knowledge_base` — база знаний (факты, разведданные, советы игрока).
  - `decision_history` — история решений и причин.
  - Q-таблица или система весов для тактик.
  - Методы: приём информации (`inject_information`), обучение (`update_strategy`), генерация докладов и отчётов.

#### 3.2. NLP-модуль (локально)
- Использование spaCy, NLTK, Duckling, Rasa NLU для парсинга текста игрока.
- Извлечение сущностей (время, события, объекты, действия) и добавление их в базу знаний генерала.
- В интерфейсе — визуализация того, как генерал "понял" сообщение игрока.

#### 3.3. Доклады и отчёты
- Генералы формируют доклады на основе истории решений и базы знаний (объясняют свои действия и планы).
- После событий (бои, катастрофы, дезертирство) формируются отчёты с анализом исхода, потерь, выводов.

#### 3.4. Интерфейс
- Главное меню: новая игра, загрузка, каталог генералов, справочник, моды, настройки, выход.
- Справочник с описаниями всех механик, юнитов, ландшафтов, достижений.
- Журнал событий, окно докладов, панель управления временем (пауза, ускорение).
- Окно для ввода информации генералам (текстовое поле + шаблоны).

#### 3.5. Модульность
- Архитектура позволяет легко добавлять новые сущности, сценарии, правила, юнитов, ландшафты, события.
- Поддержка пользовательских модов через отдельный раздел.

---

### 4. Пример сценария взаимодействия

1. Игрок останавливает время, выбирает генерала, вводит:  
   "Через 5 часов будет туман. На севере враг без генерала."
2. NLP-модуль парсит сообщение, добавляет факты в knowledge_base генерала.
3. Генерал корректирует свои планы: готовит атаку на север через 5 часов, используя туман.
4. После боя генерал формирует доклад: "Я атаковал север, потому что враг был без лидера и туман дал нам преимущество."
5. В журнале появляется отчёт о ходе и исходе боя.

---

### 5. Возможности для расширения

- Новые эпохи, культуры, уникальные сценарии.
- Развитие дипломатии, экономики, религии, династий.
- Внутренние бунты, сепаратизм, эпидемии, крупные катастрофы.
- Герои с уникальными сюжетами и влиянием на ход истории.
- Гибкая система моддинга для сообщества.

---

### 6. Технологии

- **Python** (ядро, логика, ИИ, парсинг текста)
- **Pygame** (2D-графика и интерфейс)
- **spaCy/NLTK/Rasa** (NLP для парсинга сообщений игрока)
- **JSON/Pickle** (сохранение моделей, сценариев, модов)
- **Модульная структура** для расширения и поддержки модов

---

### 7. Образовательная и стратегическая ценность

- Игра обучает стратегическому мышлению, историческим тактикам, основам ИИ и анализу последствий решений.
- Игрок может экспериментировать с влиянием на ИИ, наблюдать за эволюцией тактик и "наследием" генералов.

---

**Документ подготовлен для проектирования, планирования и реализации игры "Хроники Вечной Войны".**  
**При необходимости возможно расширение разделов с примерами кода, макетами интерфейса, схемами классов и пайплайнов.** 