# Журнал изменений (Changelog)

Этот документ отслеживает все изменения в проекте "Хроники Вечной Войны".

## Система версий
Версия имеет формат `ГЛОБАЛЬНАЯ.ЭТАП.ШАГ.ИСПРАВЛЕНИЕ`:
- **ГЛОБАЛЬНАЯ:** `0` до завершения всех этапов.
- **ЭТАП:** Номер текущего этапа разработки из `technical_plan.md`.
- **ШАГ:** Номер шага внутри этапа.
- **ИСПРАВЛЕНИЕ:** Инкремент для исправлений или итераций в рамках одного шага.

---
## История версий

### **v0.5.5.0 - (Ревизия)**
- **Ревизия:** Завершен **Этап 5**. Проведен полный аудит кода и документации.
- **Статус:** Проект стабилен, все запланированные на этап механики реализованы. Критических ошибок в коде не обнаружено.
- **Заключение:** Проект готов к **Этапу 6**. Главным блокером для дальнейшей разработки признана примитивная система генерации карт.
- **Это — базовый "бэкап" перед началом масштабных изменений.**

### **v0.5.3.0** - (текущая)
- **Оптимизация:** Полностью переработан рендеринг карты для значительного повышения производительности. Вместо отрисовки тайлов на каждом кадре, карта теперь один раз отрисовывается на отдельной поверхности (`pre-rendering`), что снимает нагрузку с CPU и повышает FPS.
- **Исправление:** ИИ-генералы теперь "фиксируются" на цели, что устраняет спам в логах из-за постоянной смены цели.
- **Исправление:** Армии больше не могут проходить сквозь непроходимые тайлы (горы, вода), так как теперь учитывают `movement_cost` ландшафта.
- **Архитектура:** Улучшена логика преследования цели в `GeneralAI` и `Army` для устранения неэффективных вызовов и более четкого разделения ответственности.
- **Файлы:** `renderer.py`, `game.py`, `army.py`, `general_ai.py`

### **v0.5.2.2**
- **Исправление:** Устранена критическая ошибка `ImportError` при запуске из-за отсутствия переменной `TILE_TYPES` в `map_generator.py`.
- **Улучшение:** Генератор карт теперь создает более разнообразный ландшафт (леса, горы), а не только траву и воду.
- **Файлы:** `map_generator.py`

### **v0.5.2.1**
- **Исправление:** Устранена критическая ошибка `SyntaxError` в `combat.py` из-за некорректного отступа в блоке `else` внутри функции `_check_for_winner`.
- **Файлы:** `combat.py`

### **v0.5.2.0**
- **Исправление:** Восстановлена функциональность камеры (движение, масштабирование) и рендеринга карты, которые были сломаны в ходе рефакторинга.
- **Исправление:** Устранен спам в логах, который происходил на каждом кадре из-за постоянного переназначения цели для ИИ.
- **Рефакторинг:** Код `Renderer` был обновлен для работы с новой централизованной структурой `world.armies`.
- **Файлы:** `game.py`, `renderer.py`, `general_ai.py`

### **v0.5.1.1**
- **Исправление:** Устранена критическая ошибка `TypeError` при инициализации класса `Unit`, которая не позволяла запустить игру. Конструктор `Unit.__init__` был исправлен для корректного приема параметра `max_hp`.
- **Файлы:** `unit.py`

### **v0.5.1.0**
- **Реализация:** Заложен фундамент для ИИ-генералов (Этап 5). Армии теперь полностью автономны.
- **Архитектура:** Создана директория `src/ai/profiles` и файлы-примеры `aggressive_general.json`, `base_knowledge.json`.
- **Реализация:** Создан класс `GeneralAI`, который загружает профили и принимает базовые решения (атака ближайшего врага).
- **Интеграция:** `GeneralAI` полностью интегрирован в `game.py`, отключено ручное управление.
- **Рефакторинг (Масштабный):** Проведен полный рефакторинг ядра игры (`game.py`, `world.py`, `army.py`, `combat.py`) для поддержки новой архитектуры, унификации кода и исправления накопившихся проблем со структурой и импортами.
- **Реализация:** Добавлена централизованная система логирования (`log.py`) для стандартизации вывода информации.
- **Файлы:** `general_ai.py`, `aggressive_general.json`, `base_knowledge.json`, `game.py`, `world.py`, `army.py`, `combat.py`, `log.py`, `implementation_checklist.md`

### **v0.4.4.0**
- **Улучшение:** Добавлена рандомизация при старте игры. Теперь начальный состав и позиции армий немного варьируются при каждом запуске, что повышает реиграбельность.
- **Файлы:** `game.py`

### **v0.4.3.0**
- **Рефакторинг:** Полностью переработана боевая система. Вместо мгновенного расчета (`resolve_combat`) внедрен пошаговый бой (`Combat` class). Бои теперь длятся во времени, юниты получают урон и уничтожаются постепенно, что делает исход менее предсказуемым.
- **Улучшение:** Переработана и значительно улучшена система логирования боя для наглядности и анализа.
- **Исправление:** Устранен ряд ошибок (`ImportError`, `TypeError`), возникших в ходе рефакторинга, и проведена общая чистка кода.
- **Файлы:** `combat.py`, `game.py`, `world.py`, `army.py`

### **v0.4.2.0**
- **Реализация:** Завершен **Этап 4** - Базовая боевая система. Реализована функция `resolve_combat`, которая рассчитывала исход боя на основе суммарной атаки и защиты юнитов. Проигравшая армия удалялась с карты.
- **Файлы:** `game.py`, `combat.py`, `world.py`

### **v0.4.1.2**
- **Улучшение:** Маркер цели (крестик) теперь исчезает, когда армия вступает в бой. Это обеспечивает корректную визуальную обратную связь, так как приказ о движении отменяется.
- **Файлы:** `game.py`

### **v0.4.1.1**
- **Исправление:** Устранена ошибка `RecursionError`, вызванная некорректной реализацией сеттера для атрибута `in_combat` в классе `Army`.
- **Файлы:** `game.py`, `army.py`

### **v0.4.1.0**
- **Реализация:** Реализован первый шаг боевой системы — обнаружение столкновений. Армии теперь входят в состояние `in_combat`, прекращают движение и однократно сообщают о начале боя.
- **Файлы:** `game.py`, `army.py`

### **v0.3.3.0**
- **Ревизия:** Завершен **Этап 3**. Реализованы базовые механики рендеринга, выбора и перемещения армий. Проект готов к **Этапу 4**.
- **Файлы:** `changelog.md`, `technical_plan.md`

### **v0.3.2.1**
- **Исправление:** Устранен визуальный "скачок" метки назначения при установке цели во время движения камеры. Движение камеры теперь приостанавливается на 1 кадр при клике мыши.
- **Файлы:** `game.py`

### **v0.3.2.0** 
- **Реализация:** Добавлена механика выбора армии (ЛКМ) и задания цели (ПКМ). Реализована визуальная обратная связь для выделения и цели. Армии теперь плавно движутся к цели.
- **Файлы:** `game.py`, `renderer.py`, `army.py`

### **v0.3.1.0**
- **Реализация:** Реализован рендеринг армий на карте. Армии отображаются в виде цветных кругов в соответствии с цветом фракции.
- **Файлы:** `world.py`, `renderer.py`, `army.py`

### **v0.2.4.0**
- **Ревизия:** Завершен **Этап 2**. Проведена полная ревизия кода и документов. Все известные проблемы с камерой, производительностью и рендерингом устранены. Проект готов к **Этапу 3**.
- **Файлы:** `changelog.md`, `technical_plan.md`, `implementation_checklist.md`

### **v0.2.3.6**
- **Настройка:** Отрегулирован `min_zoom` для корректного вписывания карты в экран при максимальном отдалении, решая проблему "слишком сильного" отдаления.
- **Файлы:** `camera.py`

### **v0.2.3.5**
- **Исправление (Архитектура):** Реализовано финальное архитектурное решение для камеры. Вся логика границ (`_clamp`) перемещена внутрь класса `Camera`, который теперь сам отвечает за свое состояние. Это решило проблему выхода за границы при масштабировании.
- **Файлы:** `camera.py`, `game.py`

### **v0.2.3.4**
- **Исправление (Управление):** Добавлена поддержка Numpad-клавиш `+` и `-` для масштабирования.
- **Файлы:** `game.py`

### **v0.2.3.3**
- **Исправление (Плавность и Зум):** Переработан `Camera` для реализации "зума к центру" и устранения "дрожания" при движении за счет округления финальных координат в `Renderer`.
- **Файлы:** `camera.py`, `renderer.py`

### **v0.2.3.2**
- **Исправление (Координаты):** Полностью переработан `Renderer` с введением `TILE_SIZE` для создания системы мировых координат. Это была первая попытка исправить фундаментальную ошибку в логике камеры.
- **Файлы:** `renderer.py`, `camera.py`, `game.py`

### **v0.2.3.1**
- **Исправление (Производительность):** В `Renderer` добавлен `culling` (отрисовка только видимых тайлов) для решения проблемы с падением FPS при движении.
- **Файлы:** `renderer.py`

### **v0.2.3.0**
- **Реализация:** Добавлена базовая камера с перемещением и масштабированием. (Изначально содержала множество багов: падение FPS, некорректная отрисовка, нелогичное масштабирование и выход за границы мира).
- **Файлы:** `camera.py`, `game.py`, `renderer.py`

### **v0.2.2.4**
- **Изменение:** Возврат к окну 1280x720 с отрисовкой карты в центральном квадрате 720x720 для сохранения пропорций.
- **Файлы:** `game.py`, `renderer.py`

### **v0.2.2.3**
- **Изменение:** Переход на полноэкранный режим по запросу.
- **Файлы:** `game.py`

### **v0.2.2.2**
- **Изменение:** Изменение окна на квадратное (800x800) для улучшения вида карты.
- **Файлы:** `game.py`

### **v0.2.2.1**
- **Исправление:** Устранена проблема с "рваной" сеткой при отрисовке карты за счет более точного расчета координат тайлов.
- **Файлы:** `renderer.py`

### **v0.2.2.0**
- **Реализация:** Добавлена визуализация карты. `Renderer` теперь отрисовывает тайлы из `world.map_data` цветными прямоугольниками.
- **Файлы:** `renderer.py`

### **v0.2.1.1**
- **Исправление:** Класс `Tile` расширен и теперь включает все поля, требуемые TDD (видимость, мораль, припасы и т.д.), чтобы избежать рефакторинга в будущем.
- **Файлы:** `tile.py`

### **v0.2.1.0**
- **Реализация:** Добавлена процедурная генерация карты. Создан класс `Tile` и генератор `generate_map`, который создает мир из земли и воды. Карта генерируется при старте игры.
- **Файлы:** `tile.py`, `map_generator.py`, `game.py`

---
### **v0.1.5.0**
- **Реализация:** Завершен архитектурный каркас. Создан класс `Renderer` для отделения логики отрисовки.
- **Файлы:** `renderer.py`, `game.py`

### **v0.1.4.0**
- **Реализация:** Созданы базовые классы-заглушки для всех игровых сущностей (`Unit`, `Army`, `Faction`, `GameWorld`).
- **Файлы:** `unit.py`, `army.py`, `faction.py`, `world.py`

### **v0.1.2.0**
- **Реализация:** Проведен рефакторинг. Логика игрового цикла вынесена из `main.py` в отдельный класс `Game`.
- **Файлы:** `game.py`, `main.py`

### **v0.1.1.0**
- **Реализация:** Настроена базовая структура проекта: созданы папки и точка входа `main.py` с инициализацией `Pygame`.
- **Файлы:** `main.py`