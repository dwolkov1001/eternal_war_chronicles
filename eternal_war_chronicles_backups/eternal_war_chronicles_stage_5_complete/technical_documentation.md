# Технический документ
## Проект: "Хроники Вечной Войны"

---

### 1. Введение

**"Хроники Вечной Войны"** — это 2D-стратегия в средневековом сеттинге (8–12 века), где игрок выступает в роли бога-наблюдателя. Игрок не управляет армиями напрямую, а влияет на ход событий через погоду, катастрофы, советы, передачу информации и другие механики. Искусственный интеллект (ИИ) генералов учится, эволюционирует и оставляет наследие, что делает каждую партию уникальной.

---

### 2. Основные игровые механики

#### 2.1. Мир и карта
- 2D-тайловая карта с ландшафтами, каждый из которых имеет подтипы с уникальными характеристиками:
  - **Равнины:**
    - *Зелёное поле:* Высокая скорость, идеально для кавалерии, но нет защиты.
    - *Выжженная пустошь:* Средняя скорость, пыль снижает видимость.
    - *Цветущий луг:* Средняя скорость, бонус к морали и восстановлению усталости.
    - *Каменистая степь:* Низкая скорость, лёгкий бонус к защите.
  - **Леса:**
    - *Хвойный бор:* Средняя скорость, хорошая защита от стрел, ограниченная видимость.
    - *Густой лиственный лес:* Низкая скорость, высокая защита, шанс потерять юнитов.
    - *Тёмная чаща:* Очень низкая скорость, идеально для засад, уязвима для огня.
    - *Редколесье:* Высокая скорость, слабая защита, подходит для манёвров.
  - **Горы:**
    - *Пологие холмы:* Средняя скорость, бонус к защите и обзору для стрелков.
    - *Крутые скалы:* Очень низкая скорость, почти полная защита, непроходимы для осадных машин.
    - *Узкое ущелье:* Высокая скорость вдоль пути, но уязвимо для атак сверху.
    - *Плато:* Средняя скорость, отличный обзор, но открыто для ветров и бурь.
  - **Водоёмы:**
    - *Мелкая река:* Низкая скорость переправы, юниты уязвимы во время перехода.
    - *Глубокое озеро:* Непроходимо, создаёт естественный барьер.
    - *Топкое болото:* Очень низкая скорость, шанс застревания, снижает мораль.
    - *Песчаный брод:* Средняя скорость переправы, но уязвим для наводнений.
  - **Городские территории:**
    - *Деревня:* Бонус к защите, возможность грабежа или рекрутирования.
    - *Укреплённый город:* Высокая защита, центр снабжения, но уязвим для осады.
    - *Замок:* Максимальная защита, командный пункт, но требует ресурсов.
    - *Разрушенные руины:* Средняя защита, бонус к засадам, но нет снабжения.
  - **Военные постройки:** лагеря (защита, восстановление), стоянки (быстрый отдых, уязвимы).
- Карта разделена на регионы, контролируемые фракциями.
- Ландшафт влияет на скорость, защиту, мораль, видимость, снабжение.
- В рамках игровой логики, для простоты и производительности, городские территории и постройки (город, деревня, замок) представляют собой **один тайл** с особыми свойствами. Масштаб одного тайла условно принимается за тактическую область (~1x1 км).

#### 2.2. Фракции и армии
- Несколько фракций с уникальными цветами, гербами, стартовыми условиями.
- Армии формируются фракциями, пополняются наймом, слиянием, разделением. **Армия — это визуальная абстракция и контейнер**, который объединяет группу юнитов в одной точке.
- Армии состоят из разных типов юнитов и специальных отрядов. На начальном этапе боевая мощь армии рассчитывается на основе **суммарных показателей юнитов**. По мере развития тактических возможностей (разделение на отряды) боевая система усложняется, чтобы учитывать **позиционирование, тактики генерала и взаимодействие между отдельными отрядами** в рамках одного сражения.

#### 2.3. Юниты и специальные отряды
- **Пехота:**
  - *Копейщики:* Сильны против кавалерии, слабы против стрелков.
  - *Мечники:* Универсальны, бонус в лесах за манёвренность.
  - *Щитоносцы:* Высокая защита, но медленны на равнинах и в болотах.
  - *Алебардщики:* Эффективны против брони, но уязвимы на открытой местности.
- **Кавалерия:**
  - *Лёгкая кавалерия:* Быстрая, идеальна для разведки и флангов на равнинах.
  - *Тяжёлая кавалерия:* Мощная атака, но теряет эффективность в лесах и горах.
  - *Конные лучники:* Стреляют на ходу, слабы в ближнем бою и на пересечённой местности.
  - *Рыцари-копейщики:* Сокрушительный первый удар, но медленное восстановление.
- **Стрелки:**
  - *Лучники:* Дальний бой, бонус на холмах, слабы в дождь и туман.
  - *Арбалетчики:* Пробивают броню, медленная перезарядка, хороши в обороне.
  - *Пращники:* Дешёвые, слабые, но быстрые и мобильные.
  - *Метатели дротиков:* Средняя дальность, бонус против лёгких юнитов.
- **Осадные машины:**
  - *Катапульта:* Разрушает стены и здания, но медленная и уязвима для атак.
  - *Таран:* Ломает ворота, но требует защиты от стрелков.
  - *Баллиста:* Точная атака на дистанции, пробивает броню юнитов.
  - *Огненный требушет:* Поджигает леса и здания, но сложен в управлении.
- **Обозы:** отвечают за снабжение армии (еда, боезапас, медикаменты).
- **Спец. отряды:** разведчики, инженеры, жрецы, шпионы, телохранители, убийцы, диверсанты, герои/легендарные личности.

#### 2.4. Генералы и ИИ
- Каждый генерал — **уникальный, нематериальный ИИ-агент ("мозг" армии)** с характером, стартовой базой знаний и системой обучения. Он не может быть убит в бою, но может быть смещён или дезертировать.
- **Личность и характер:** Личность каждого генерала определяется набором качественных **черт** (`"Храбрец"`, `"Тактик"`, `"Трус"`) и количественных параметров (`"агрессия"`, `"осторожность"`), которые хранятся во внешнем профиле (например, JSON-файле). Эти параметры напрямую влияют на его поведение в бою и на карте.
- **Отношения:** Генералы формируют личные отношения (`"дружба"`, `"соперничество"`, `"ненависть"`) друг с другом, что влияет на их выбор целей и может приводить к личным вендеттам.
- **Обучение и память:** Генералы учатся во время и после боёв, корректируя свои тактики и параметры в профиле. Они запоминают не только исход боя, но и ключевые события (кто их победил, на каком ландшафте), что позволяет им избегать повторения ошибок.
- **Лояльность и амбиции:** У каждого генерала есть уровень лояльности к своей фракции и могут быть скрытые личные амбиции (`"захватить столицу"`). Низкая лояльность, вызванная поражениями или нехваткой снабжения, может привести к дезертирству или предательству.
- Решения ИИ-генерала (директивы) являются результатом его **внутренней логики**, основанной на его характере, знаниях и текущей ситуации на поле боя.

#### 2.5. Погода, времена года, катастрофы
- Динамическая погода: дождь, снег, туман, буря, жара, мороз.
- Цикл дня и ночи, смена сезонов.
- Катастрофы: чума, засуха, пожары, нашествия саранчи, землетрясения, наводнения.
- Погодные и сезонные эффекты влияют на боеспособность, снабжение, мораль, передвижение.
- **Обида на игрока (Grudge System):** Если игрок ("бог") систематически дает генералу плохие советы, приводящие к поражениям, у генерала может развиться черта `"Недоверчивый"`, и он начнет игнорировать или даже действовать вопреки советам игрока.
- Передача любой информации генералам (NLP-модуль парсит и интерпретирует текст).
- Остановка времени, допрос генерала о мотивах и планах.
- Поддержка или подавление бунтов, вмешательство в катастрофы.
- **Примечание:** Для разработки и отладки этих механик на ранних этапах создается **специализированный отладочный UI**, позволяющий визуализировать, как ИИ интерпретирует команды.

#### 2.6. Влияние игрока
- Изменение погоды и вызов катастроф.
- Советы генералам (через шаблоны или свободный текст).
- Передача любой информации генералам (NLP-модуль парсит и интерпретирует текст).
- Остановка времени, допрос генерала о мотивах и планах.
- Поддержка или подавление бунтов, вмешательство в катастрофы.

#### 2.7. Боевая система
- Открытые сражения, засады, осады, ночные налёты, диверсии, стычки.
- Тактики зависят от ландшафта, погоды, времени суток, морали, снабжения, советов игрока.
- Генералы учатся и меняют тактику по ходу боя.
- После боя — анализ, корректировка базы знаний, формирование отчётов.
- При низкой морали или отсутствии снабжения (еды) — дезертирство, небоевые потери, бунты.

#### 2.8. Снабжение и расходники
- Боезапас, медикаменты (травы, мази, вино и др.), еда и вода, броня и оружие.
- Расходуются в боях, походах, пополняются через обозы и в поселениях.
- Поселения (города, деревни) производят ресурсы, необходимые для найма и содержания юнитов. Различные типы поселений специализируются на разных ресурсах.
- При низкой морали или отсутствии снабжения (еды) — дезертирство, небоевые потери, бунты.

#### 2.9. Герои, достижения и сценарии
- **Герои** — это **уникальные, сверхмощные юниты**, которые являются частью армии. В отличие от нематериального генерала, герой **сражается на поле боя, имеет характеристики и может быть ранен или убит.**
- Герои обладают особыми способностями (например, аура, повышающая мораль, или мощный "боевой клич" в бою), которые могут переломить ход сражения.
- Система достижений и сценариев для генералов (например, "непобедимый", "мастер засад", "спаситель обозов").
- Достижения влияют на наследие генералов и бонусы для преемников.

#### 2.10. Модульность и поддержка модов
- Лёгкое добавление новых юнитов, ландшафтов, сценариев, тактик, событий.
- Раздел "Моды" в главном меню для управления пользовательскими дополнениями.

#### 2.11. Действия на карте мира
- Некоторые юниты (например, инженеры, шпионы) могут выполнять **длительные действия прямо на карте мира** (строительство форта, саботаж).
- Эти действия занимают определенное время (например, несколько игровых дней) и могут быть **прерваны** вражеским вмешательством (например, атакой на отряд, выполняющий действие).

---

### 3. Техническая архитектура

#### 3.1. Ядро ИИ-генерала
- Класс `GeneralAI`:
  - `knowledge_base` — база знаний (факты, разведданные, советы игрока). Загружается из внешнего файла и дополняется в ходе игры.
  - `personality` — объект с чертами характера и параметрами личности. Загружается из профиля.
  - `decision_history` — история решений и причин.
  - Q-таблица или система весов для тактик, которая модифицируется в процессе обучения.
  - Методы: приём информации (`inject_information`), обучение (`update_strategy`), генерация докладов и отчётов.

#### 3.2. NLP-модуль (локально)
- Использование spaCy, NLTK, Duckling, Rasa NLU для парсинга текста игрока.
- Извлечение сущностей (время, события, объекты, действия) и добавление их в базу знаний генерала.
- В интерфейсе — визуализация того, как генерал "понял" сообщение игрока.

#### 3.3. Доклады и отчёты
- Генералы формируют доклады на основе истории решений и базы знаний (объясняют свои действия и планы).
- После событий (бои, катастрофы, дезертирство) формируются отчёты с анализом исхода, потерь, выводов.

#### 3.4. Интерфейс
- Главное меню: новая игра, загрузка, каталог генералов, справочник, моды, настройки, выход.
- Справочник с описаниями всех механик, юнитов, ландшафтов, достижений.
- Журнал событий, окно докладов, панель управления временем (пауза, ускорение).
- Окно для ввода информации генералам (текстовое поле + шаблоны).

#### 3.5. Модульность
- Архитектура позволяет легко добавлять новые сущности, сценарии, правила, юнитов, ландшафты, события.
- Поддержка пользовательских модов через отдельный раздел.

---

### 4. Пример сценария взаимодействия

1. Игрок останавливает время, выбирает генерала, вводит:  
   "Через 5 часов будет туман. На севере враг без генерала."
2. NLP-модуль парсит сообщение, добавляет факты в knowledge_base генерала.
3. Генерал корректирует свои планы: готовит атаку на север через 5 часов, используя туман.
4. После боя генерал формирует доклад: "Я атаковал север, потому что враг был без лидера и туман дал нам преимущество."
5. В журнале появляется отчёт о ходе и исходе боя.

---

### 5. Возможности для расширения

- Новые эпохи, культуры, уникальные сценарии.
- Развитие дипломатии, экономики, религии, династий.
- Внутренние бунты, сепаратизм, эпидемии, крупные катастрофы.
- Герои с уникальными сюжетами и влиянием на ход истории.
- Гибкая система моддинга для сообщества.

#### 5.1. Глобальные дополнения и игровые режимы (Идеи на будущее)

1.  **"Расширение Реалистичности" (модуль):**
    *   **Суть:** Добавление опционального режима повышенной сложности и реализма, который можно будет включать в настройках партии.
    *   **Механика гонцов:** Приказы от генерала к армии/отрядам передаются не мгновенно, а через юнитов-гонцов. Гонца могут перехватить или убить, что вносит задержку в управление, открывает простор для диверсий и требует охраны линий коммуникаций.
    *   **Расширенный мир:** Появление на карте нейтральных банд разбойников, усложненные механики ландшафта, новые типы юнитов и событий.

2.  **Режим "Игрок-Генерал":**
    *   **Суть:** Игрок выступает не в роли "бога", а в роли одного из ИИ-генералов.
    *   **Геймплей:** Прямое управление армией, участие в сражениях, принятие тактических решений на поле боя. Божественные функции (управление погодой, глобальные советы) полностью недоступны.
    *   **Цель:** Победить других ИИ-генералов в "честном" бою, используя только свои тактические навыки.

3.  **Режим "Мультиплеер":**
    *   **Суть:** Совместная или соревновательная игра для нескольких игроков.
    *   **Варианты:**
        *   **Два Наблюдателя:** Два игрока в роли "богов" влияют на один и тот же мир, поддерживая разные фракции.
        *   **Бог против Генерала:** Один игрок — "бог", второй — генерал одной из фракций.
        *   **Два Генерала:** Два игрока управляют генералами и их армиями, сражаясь друг против друга на одной карте.

---

### 6. Технологии

- **Python** (ядро, логика, ИИ, парсинг текста)
- **Pygame** (2D-графика и интерфейс)
- **spaCy/NLTK/Rasa** (NLP для парсинга сообщений игрока)
- **JSON/Pickle** (сохранение моделей, сценариев, модов)
- **Модульная структура** для расширения и поддержки модов

---

### 7. Образовательная и стратегическая ценность

- Игра обучает стратегическому мышлению, историческим тактикам, основам ИИ и анализу последствий решений.
- Игрок может экспериментировать с влиянием на ИИ, наблюдать за эволюцией тактик и "наследием" генералов.

---

**Документ подготовлен для проектирования, планирования и реализации игры "Хроники Вечной Войны".**  
**При необходимости возможно расширение разделов с примерами кода, макетами интерфейса, схемами классов и пайплайнов.** 